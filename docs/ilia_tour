Hi. Lets take a tour of working with the cc locally and do a few basic
operations.

Heads up.. the CC doesn't match the API doc yet.  This tour will guide you
around the pitfalls.

Run the CC

  First, let's get your cloud controller running.  To do so, in another window
  run:

    bin/cloud_controller -d -m

  -d puts the cc into developer mode. -m will cause it to run migrations.

  You don't really have to go into dev mode, but you do need to run -m at
  least once.


Test the CC

  Your cc should be up and running on port 8080 now, so test it out.
  with:

    curl -v http://localhost:8080/

  You should get a 404 back and a custom error body.  We should probably be
  nicer about returning something for /, but for now, meh.

  That error body is the standard sort of error that you will expect to see for
  other types of errors.

Bootstrap an Admin

  Ok.. let's get your admin user created.  We really need an external
  bootstrap tool to insert an initial admin into the db, but for now, you can
  do the following

    curl -v http://localhost:8080/bootstrap

  You should get back an HTTP 201 and a blob of json.  That blob of json
  is "standard" in that you get back the representation of the object that you
  created on the create.  Granted, this call is bypassing the normal APIs, it
  should have been a PUT, shoul dhave returned a Location header, yada yada.

Let's see a server error:

  If you run the same command again:

    curl -v http://localhost:8080/bootstrap

  You will get back a 500 and a custom server error response body.  This is
  because the bootstrap route bypasses the API.  Had you gone through the API
  you would have gotten a real error message.  Still, you didn't get a blob of
  html on an unhandled error like in the original cc.

  Note the window you are running the cc in.  You should see a big stack trace.
  If you get any weird server errors, go check for those sort of backtraces and
  send them to me.

Let's create an org:

  Ok, this will be a load of fun!

     curl -X POST -H "Content-Type: application/json" \
       -d '{"name":"my cool org"}' \
       http://localhost:8080/v2/organizations

  Oh, you got an auth error.  Silly you.


Let's create an org with "correct" auth/authz

 Ok, this will be even more fun.  Fun like a horror movie.  (UAA integration
 is coming.  We used to have our own signed token, but didn't bother checking
 it in because the UAA is the true new hotness.)

   curl -X POST -H "Content-Type: application/json" \
    -H "Authorization: iliag@vmware.com" \
    -d '{"name":"my cool org"}' \
    http://localhost:8080/v2/organizations

 Now this time you should get something back like:

   {"id":1,"name":"my cool org","user_ids":[],"app_space_ids":[],
   "created_at":"2012-05-01 13:22:56 -0700","updated_at":null}

 Yay.

 Note the Location header in the response.  You should be able to do
 a GET on that.


Let's double check our org:

    curl -H "Authorization: iliag@vmware.com" \
    http://localhost:8080/v2/organizations/1

  Double yay.


Let's rename the org:

    curl -v -X PUT -H "Content-Type: application/json" \
    -H "Authorization: iliag@vmwm" \
    -d '{"name":"ilia likes orgs"}' \
    http://localhost:8080/v2/organizations/1


Let's go create a user:

    curl -v -X POST -H "Content-Type: application/json" \
    -H "Authorization: iliag@vmware.com" \
    -d '{"email":"someguy@vmware.com", "password":"hope this is over https"}' \
    http://localhost:8080/v2/users


So now we should have 2 users, (the boot strap user, plus the one above)
let's see:

    curl -v -H "Authorization: iliag@vmware.com" http://localhost:8080/v2/users

    [{"id":1,"email":"iliag@vmware.com","admin":true,"active":true,
    "organization_ids":[],"app_space_ids":[],
    "created_at":"2012-05-01 12:51:28 -0700","updated_at":null},
    {"id":2,"email":"someguy@vmware.com","admin":false,"active":false,
    "organization_ids":[],"app_space_ids":[],"created_at":"2012-05-01
    13:34:53 -0700","updated_at":null}]

  Yep

Check the orgs the same way:

    curl -v -H "Authorization: iliag@vmware.com" \
    http://localhost:8080/v2/organizations


Now let's add that someguy@vmware.com to the org:

    curl -v -X PUT -H "Content-Type: application/json" \
    -H "Authorization: iliag@vmwm" \
    -d '{"user_ids":[2]}' \
    http://localhost:8080/v2/organizations/1

  Note that the response shows the user in the list of user ids.


And just for more fun, let's go check that user:

   curl -v -H "Authorization: iliag@vmware.com" \
   http://localhost:8080/v2/users/2

   {"id":2,"email":"someguy@vmware.com","admin":false,"active":false,
   "organization_ids":[1],"app_space_ids":[],"created_at":"2012-05-01
   13:34:53 -0700","updated_at":null}p

 Yep.. he shows up in org 1 as expected.


Note.. the APIs are going to cut over to the correct/new form in the next few
days.  These are the "old" forms, but should be good enough to get you going
with the general flow.
